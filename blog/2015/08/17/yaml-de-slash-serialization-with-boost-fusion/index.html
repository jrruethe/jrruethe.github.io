
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Yaml De/Serialization With Boost Fusion - Morning Musings</title>
  <meta name="author" content="Joe Ruether">

  
  <meta name="description" content="In a previous post I did a rather lengthy walkthrough of how to create a Json pretty printer for any object using Boost Fusion. This time I will be &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Morning Musings" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
  jQuery.noConflict();
  var rootUrl = "";
</script>
<script src="/javascripts/openlayers/OpenLayers.js" type="text/javascript"></script>
<script src="/javascripts/maps.js" type="text/javascript"></script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Morning Musings</a></h1>
  
    <h2>I'm not ready to wake up yet...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jrruethe.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/license">License</a></li>
  <li><a href="/blog/about">About</a></li>
  <li><a href="/blog/contact">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Yaml De/Serialization With Boost Fusion</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-08-17T20:17:35-04:00" pubdate data-updated="true">Aug 17<span>th</span>, 2015</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://jrruethe.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>In a <a href="">previous post</a> I did a rather lengthy walkthrough of how to create a Json pretty printer for any object using Boost Fusion. This time I will be doing the same thing, only with Yaml.</p>

<p>This method relies on a third party library<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>, but the end result is much cleaner. This method supports both serialization and deserialization. As a bonus, it can also work with Json!</p>

<p>To run the following code, you will need these libraries installed:</p>

<ul>
<li>libboost-all-dev</li>
<li>libyaml-cpp-dev</li>
</ul>


<p>I am using yaml-cpp version 0.5.1, and some internals are exposed. There is a possibility that this method would not work with a future version.</p>

<p>The first part is similar to before; creating some wrappers around the Boost Fusion / MPL calls for ease of use. Hopefully the comments and names are straightforward:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">sequence</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Point to the first element</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">begin</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Point to the element after the last element in the sequence</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Point to the first element</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">first</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Point to the second element (for pairs)</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">second</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Point to the last element in the sequence</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">prior</span><span class="o">&lt;</span><span class="n">end</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">last</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Number of elements in the sequence</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">size</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">range_c</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span>
</span><span class='line'>         <span class="k">typename</span> <span class="n">N</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">element_at</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Type of the element at this index</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">value_at</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Previous element</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">prior</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">previous</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Next element</span>
</span><span class='line'>    <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">next</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">next</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Member name of the element at this index</span>
</span><span class='line'>    <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">extension</span><span class="o">::</span><span class="n">struct_member_name</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;::</span><span class="n">call</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Type name of the element at this index</span>
</span><span class='line'>    <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="n">type</span><span class="p">).</span><span class="n">name</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Access the element</span>
</span><span class='line'>    <span class="k">static</span> <span class="kr">inline</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at</span><span class="o">&lt;</span><span class="n">S</span> <span class="k">const</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">get</span><span class="p">(</span><span class="n">S</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">type</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// Return the string name of the type</span>
</span><span class='line'>    <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">name</span><span class="p">());</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>We need two functors:</p>

<ul>
<li>One to insert items into a Yaml node</li>
<li>One to extract items from a Yaml node</li>
</ul>


<p>Lets do the inserter first. The constructor will take in a Yaml node to insert into, and <code>operator()</code> will take in a Zip element. A Zip element is a tuple created by boost::fusion::for_each that is used to zip together two lists. The concept is the same as in Python:</p>

<!--escape--><div class='escape-wrapper'><notextile><!--content--><figure class='code'><figcaption><span></span></figcaption><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="o">&gt;</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span class='line'><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure><!--end-content--></notextile></div>


<!--end-escape-->


<p>The code performs the following operations:</p>

<ol>
<li>Grabs the index from the zip</li>
<li>Gets the name of that field using reflection</li>
<li>Gets the type of that field</li>
<li>Aliases the member for convenience</li>
<li>Stores the member under its name in the Yaml node</li>
</ol>


<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number marked'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">inserter</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">typedef</span> <span class="n">T</span> <span class="n">Type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">inserter</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">subroot</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>      <span class="n">mSubroot</span><span class="p">(</span><span class="n">subroot</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Zip</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Zip</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">zip</span><span class="p">)</span> <span class="k">const</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_const</span><span class="o">&lt;</span>
</span><span class='line'>                 <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_reference</span><span class="o">&lt;</span>
</span><span class='line'>                    <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="n">Zip</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                 <span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>              <span class="o">&gt;::</span><span class="n">type</span> <span class="n">Index</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Get the field name as a string using reflection</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">field_name</span> <span class="o">=</span> <span class="n">element_at</span><span class="o">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Index</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Get the field type</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">BOOST_TYPEOF</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">))</span> <span class="n">FieldType</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Alias the member</span>
</span><span class='line'>      <span class="n">FieldType</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">member</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Store this field in the yaml node</span>
</span><span class='line marked start end'>      <span class="n">mSubroot</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span><span class="o">:</span>
</span><span class='line'>   <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">mSubroot</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The extractor is the same concept, but it is slightly more difficult for three reasons:</p>

<ol>
<li>Parsing a file can fail, and <code>yaml-cpp</code> is not very good at reporting useful errors.</li>
<li><code>boost::fusion::for_each</code> requires the zip and <code>operator()</code> to be const.</li>
<li><code>boost::fusion::for_each</code> requires <code>operator()</code> to return void.</li>
</ol>


<p>To solve these issues, we use the reflection capabilities to identify the field we are trying to load, and can report that on failure. Maintaining an item count also provides useful information for the error reporting. Using <code>const_cast</code> gets around the const requirements in an ugly manner. Finally, instead of returning <code>false</code> on error, we throw an exception that needs to be caught later.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number marked'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">extractor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">typedef</span> <span class="n">T</span> <span class="n">Type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">extractor</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">subroot</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>      <span class="n">mSubroot</span><span class="p">(</span><span class="n">subroot</span><span class="p">),</span>
</span><span class='line'>      <span class="n">mItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Zip</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Zip</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">zip</span><span class="p">)</span> <span class="k">const</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_const</span><span class="o">&lt;</span>
</span><span class='line'>                 <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_reference</span><span class="o">&lt;</span>
</span><span class='line'>                    <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="n">Zip</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                 <span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>              <span class="o">&gt;::</span><span class="n">type</span> <span class="n">Index</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Get the field name as a string using reflection</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">field_name</span> <span class="o">=</span> <span class="n">element_at</span><span class="o">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Index</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Get the field native type</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">BOOST_TYPEOF</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">))</span> <span class="n">FieldType</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Alias the member</span>
</span><span class='line'>      <span class="c1">// We need to const cast this because &quot;boost::fusion::for_each&quot;</span>
</span><span class='line'>      <span class="c1">// requires that zip be const, however we want to modify it.</span>
</span><span class='line'>      <span class="n">FieldType</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">const_member</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">);</span>
</span><span class='line'>      <span class="n">FieldType</span><span class="o">&amp;</span> <span class="n">member</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">const_member</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// We need to const cast this because &quot;boost::fusion::for_each&quot;</span>
</span><span class='line'>      <span class="c1">// requires that operator() be const, however we want to modify</span>
</span><span class='line'>      <span class="c1">// the object. This item number is used for error reporting.</span>
</span><span class='line'>      <span class="kt">int</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">const_item</span> <span class="o">=</span> <span class="n">mItem</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">int</span><span class="o">&amp;</span> <span class="n">item</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">const_item</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Try to load the value from the file</span>
</span><span class='line'>      <span class="k">try</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Extract this field from the yaml node</span>
</span><span class='line marked start end'>         <span class="n">member</span> <span class="o">=</span> <span class="n">mSubroot</span><span class="p">[</span><span class="n">field_name</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// This item number helps us find issues when loading incomplete yaml files</span>
</span><span class='line'>         <span class="o">++</span><span class="n">item</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="c1">// Catch any exceptions</span>
</span><span class='line'>      <span class="k">catch</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Exception</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Print out some helpful information to find the error in the yaml file</span>
</span><span class='line'>         <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_name</span> <span class="o">=</span> <span class="n">type</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>         <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error loading item &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span>  <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">type_name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">field_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// &quot;boost::fusion::for_each&quot; requires operator() to return void,</span>
</span><span class='line'>         <span class="c1">// so the only way to signal that an error occurred is to throw</span>
</span><span class='line'>         <span class="c1">// an exception.</span>
</span><span class='line'>         <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span><span class="o">:</span>
</span><span class='line'>   <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">mSubroot</span><span class="p">;</span>
</span><span class='line'>   <span class="kt">int</span> <span class="n">mItem</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>Pay attention to the highlighted lines in the above <code>inserter</code> and <code>extractor</code>.<br/>
The call to <code>operator=</code> in the inserter leads to this code being run inside the <code>yaml-cpp</code> library:</p>

<figure class='code'><figcaption><span>&#8220;yaml-cpp/node/impl.h&#8221; </span></figcaption><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number marked'>208</span>
<span class='line-number'>209</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">inline</span> <span class="kt">void</span> <span class="n">Node</span><span class="o">::</span><span class="n">Assign</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">m_isValid</span><span class="p">)</span>
</span><span class='line'>        <span class="k">throw</span> <span class="n">InvalidNode</span><span class="p">();</span>
</span><span class='line marked start end'>    <span class="n">AssignData</span><span class="p">(</span><span class="n">convert</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">encode</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The call to <code>as</code> in the extractor leads to this code being run inside the <code>yaml-cpp</code> library:</p>

<figure class='code'><figcaption><span>&#8220;yaml-cpp/node/impl.h&#8221; </span></figcaption><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number marked'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// template helpers</span>
</span><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">as_if</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">explicit</span> <span class="n">as_if</span><span class="p">(</span><span class="k">const</span> <span class="n">Node</span><span class="o">&amp;</span> <span class="n">node_</span><span class="p">)</span><span class="o">:</span> <span class="n">node</span><span class="p">(</span><span class="n">node_</span><span class="p">)</span> <span class="p">{}</span>
</span><span class='line'>    <span class="k">const</span> <span class="n">Node</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">const</span> <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">S</span><span class="o">&amp;</span> <span class="n">fallback</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">node</span><span class="p">.</span><span class="n">m_pNode</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">fallback</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">T</span> <span class="n">t</span><span class="p">;</span>
</span><span class='line marked start end'>        <span class="k">if</span><span class="p">(</span><span class="n">convert</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">decode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">fallback</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The documentation states that user specified data types can specialize the <code>YAML::convert&lt;&gt;</code> class to handle encoding and decoding properly. Below is a screenshot of the documentation about this:</p>

<p><img class="center" src="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/01.png"></p>

<p>However, there is a small obstacle when trying to specialize the <code>convert</code> structure for our fusion sequence:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number marked'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">namespace</span> <span class="n">YAML</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;&gt;</span>
</span><span class='line marked start end'>   <span class="k">struct</span> <span class="n">convert</span><span class="o">&lt;???&gt;</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">static</span> <span class="n">Node</span> <span class="n">encode</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">static</span> <span class="kt">bool</span> <span class="n">decode</span><span class="p">(</span><span class="n">Node</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t specialize in a general sense because <code>???</code> would either have to be a template parameter, or we would need one of these for every <code>BOOST_FUSION_ADAPT_STRUCT</code> we create.
Normally in this type of situation, we could use partial specialization if there was a second template parameter, even if it was a dummy variable that allowed us to use <code>boost::enable_if</code>.</p>

<p>Digging around the source a little more, we find this gem, and the answer to our problems:</p>

<figure class='code'><figcaption><span>&#8220;yaml-cpp/node/node.h&#8221; </span></figcaption><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">struct</span> <span class="n">convert</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thats right! The convert structure is only forward declared, it is never actually defined! This means <em>we</em> can define it to be whatever we want!</p>

<p>Time to use some <code>boost::enable_if</code> magic. We add a dummy variable to both <code>encode</code> and <code>decode</code> that only enable those functions if the template parameter is a <code>boost::fusion</code> sequence. This allows the signatures of everything to match. Whenever a type <code>T</code> is not specialized by the library, the compiler will try to use our definition, which will only take effect if the type is a sequence. Otherwise, a compiler error will be thrown just as it would have before. In addition, this method still allows one to specialize for their type if they need extra functionality.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">namespace</span> <span class="n">YAML</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="k">struct</span> <span class="n">convert</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'>      <span class="k">static</span> <span class="n">Node</span> <span class="n">encode</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                         <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'>      <span class="k">static</span> <span class="kt">bool</span> <span class="n">decode</span><span class="p">(</span><span class="n">Node</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                         <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the <code>encode</code> method, we iterate over every field in the sequence using the inserter, which will recurse through all the sub-sequences until we hit the &ldquo;bottom&rdquo;. Every sequence is made up of primitive at some level, so eventually the recursion will stop as specializations of <code>encode</code> get called instead of the one we defined.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'><span class="k">static</span> <span class="n">Node</span> <span class="n">encode</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                   <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="c1">// For each item in T</span>
</span><span class='line'>   <span class="c1">// Call inserter recursively</span>
</span><span class='line'>   <span class="c1">// Every sequence is made up of primitives at some level</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>   <span class="k">typedef</span> <span class="k">typename</span> <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Make a root node to insert into</span>
</span><span class='line'>   <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Create an inserter for the root node</span>
</span><span class='line'>   <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">inserter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">inserter</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Insert each member of the structure</span>
</span><span class='line'>   <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">),</span> <span class="n">inserter</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">return</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>decode</code> method works the same way, using the <code>extractor</code>. Remember that the extractor throws on error, so the exception needs to be caught.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'><span class="k">static</span> <span class="kt">bool</span> <span class="n">decode</span><span class="p">(</span><span class="n">Node</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                   <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="c1">// For each item in T</span>
</span><span class='line'>   <span class="c1">// Call extractor recursively</span>
</span><span class='line'>   <span class="c1">// Every sequence is made up of primitives at some level</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>   <span class="k">typedef</span> <span class="k">typename</span> <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Create an extractor for the root node</span>
</span><span class='line'>   <span class="c1">// Yaml-cpp requires node to be const&amp;, but the extractor makes</span>
</span><span class='line'>   <span class="c1">// non-const calls to it.</span>
</span><span class='line'>   <span class="n">Node</span><span class="o">&amp;</span> <span class="n">writable_node</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span><span class='line'>   <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">extractor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">extractor</span><span class="p">(</span><span class="n">writable_node</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// Extract each member of the structure</span>
</span><span class='line'>   <span class="k">try</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="c1">// An exception is thrown if any item in the loop cannot be read</span>
</span><span class='line'>      <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">),</span> <span class="n">extractor</span><span class="p">);</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="c1">// Catch all exceptions and prevent them from propagating</span>
</span><span class='line'>   <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">// If we made it here, all fields were read correctly</span>
</span><span class='line'>   <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok! All the pieces and parts are completed. Time to make a mixin to wrap it all up. We want objects to have method to convert to and from Yaml and Json (remember that Json is a subset of Yaml, so the yaml parser gives us both abilities for free!). All we need to do is kickstart the recursion using the <code>inserter</code> and <code>extractor</code>.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">namespace</span> <span class="n">yaml</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="k">class</span> <span class="nc">Yaml</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>   <span class="k">public</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">T</span> <span class="n">Base</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Convert this object to yaml</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_yaml</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create an emitter</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span> <span class="n">emitter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit yaml</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emit</span><span class="p">(</span><span class="n">emitter</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Convert this object to json</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_json</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create an emitter</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span> <span class="n">emitter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Set the emitter manipulators for json</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Flow</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">DoubleQuoted</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">TrueFalseBool</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">EscapeNonAscii</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit json</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emit</span><span class="p">(</span><span class="n">emitter</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Load yaml into this object</span>
</span><span class='line'>      <span class="kt">bool</span> <span class="n">from_yaml</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">yaml_string</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create a root node to load into</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">try</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Try loading the root node</span>
</span><span class='line'>            <span class="n">root</span> <span class="o">=</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Load</span><span class="p">(</span><span class="n">yaml_string</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// The yaml couldn&#39;t be parsed</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Invalid yaml&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an extractor for the root node</span>
</span><span class='line'>         <span class="n">detail</span><span class="o">::</span><span class="n">extractor</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">extractor</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Extract each member of the structure</span>
</span><span class='line'>         <span class="k">try</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// An exception is thrown if any item in the loop cannot be read</span>
</span><span class='line'>            <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">self</span><span class="p">()),</span> <span class="n">extractor</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="c1">// Catch all exceptions and prevent them from propagating</span>
</span><span class='line'>         <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// If we made it here, all fields were read correctly</span>
</span><span class='line'>         <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// The yaml parser can also parse json</span>
</span><span class='line'>      <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">from_json</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">json_string</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">from_yaml</span><span class="p">(</span><span class="n">json_string</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">protected</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">emit</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span><span class="o">&amp;</span> <span class="n">emitter</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Make a root node to insert into</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an inserter for the root node</span>
</span><span class='line'>         <span class="n">detail</span><span class="o">::</span><span class="n">inserter</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">inserter</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Insert each member of the structure</span>
</span><span class='line'>         <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">self</span><span class="p">()),</span> <span class="n">inserter</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit yaml</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Return string representation</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emitter</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">private</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Cast ourselves to our CRTP base</span>
</span><span class='line'>      <span class="n">Base</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Time to test it. First we create some test structures with different types and containers, and adapt them into sequences:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number marked'>13</span>
<span class='line-number'>14</span>
<span class='line-number marked'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number marked'>30</span>
<span class='line-number marked'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number marked'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sstream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;map&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">yaml</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">test</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">struct</span> <span class="n">One</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line marked start end'>      <span class="k">friend</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">extension</span><span class="o">::</span><span class="n">access</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line marked start end'>      <span class="n">One</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>         <span class="n">two</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span><span class='line'>         <span class="n">three</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
</span><span class='line'>         <span class="n">four</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">One</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">c</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>         <span class="n">two</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span class='line'>         <span class="n">three</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
</span><span class='line'>         <span class="n">four</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">int</span> <span class="n">two</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">double</span> <span class="n">three</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line marked start'>   <span class="k">private</span><span class="o">:</span>
</span><span class='line marked end'>      <span class="kt">bool</span> <span class="n">four</span><span class="p">;</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'>
</span><span class='line marked start end'>   <span class="k">struct</span> <span class="n">Five</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Yaml</span><span class="o">&lt;</span><span class="n">Five</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">One</span><span class="o">&gt;</span> <span class="n">Map_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Map_t</span> <span class="n">six</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">One</span><span class="o">&gt;</span> <span class="n">Vector_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Vector_t</span> <span class="n">seven</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">eight</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">Matrix_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Matrix_t</span> <span class="n">nine</span><span class="p">;</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">BOOST_FUSION_ADAPT_STRUCT</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>   <span class="n">test</span><span class="o">::</span><span class="n">One</span><span class="p">,</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">four</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">BOOST_FUSION_ADAPT_STRUCT</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>   <span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="p">,</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Map_t</span><span class="p">,</span> <span class="n">six</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Vector_t</span><span class="p">,</span> <span class="n">seven</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">eight</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Matrix_t</span><span class="p">,</span> <span class="n">nine</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>A couple things to note here. First off, a default constructor is required for decoding. Secondly, if you want to adapt private or protected members, your class must befriend the <code>boost::fusion::extension::access</code> class. Finally, the top-level structure that you want to serialize / deserialize must inherit from the <code>Yaml&lt;&gt;</code> mixin.</p>

<p>To try it out, populate the structure and output it as Yaml and Json. Then try parsing a different Yaml string and make sure the structure was populated accordingly:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">test</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">Five</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">six</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">One</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="kc">true</span><span class="p">)));</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">six</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">456</span><span class="p">,</span> <span class="n">One</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">,</span> <span class="kc">false</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">seven</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">One</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">seven</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">One</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">eight</span> <span class="o">=</span> <span class="s">&quot;eight&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'>   <span class="n">temp</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mf">2.3</span><span class="p">);</span>
</span><span class='line'>   <span class="n">temp</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mf">4.5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">nine</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">nine</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_json</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">///////////////////////////////////////////</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;==============&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;six:            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  234:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    two: 4      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 5.5  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  345:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    two: 6      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 7.7  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: false </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;seven:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  - two: 8      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 9.9  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  - two: 2      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 3.3  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;eight: nine     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;nine:           </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  -             </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 3.4       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 5.6       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  -             </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 7.8       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 9.0       </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The output is:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">six</span><span class="p">:</span>
</span><span class='line'>  <span class="mi">123</span><span class="p">:</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">6.6</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'>  <span class="mi">456</span><span class="p">:</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">4</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">8.800000000000001</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">false</span>
</span><span class='line'><span class="n">seven</span><span class="p">:</span>
</span><span class='line'>  <span class="o">-</span> <span class="n">two</span><span class="p">:</span> <span class="mi">5</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">1.1</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'>  <span class="o">-</span> <span class="n">two</span><span class="p">:</span> <span class="mi">5</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">2.2</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'><span class="n">eight</span><span class="p">:</span> <span class="n">eight</span>
</span><span class='line'><span class="n">nine</span><span class="p">:</span>
</span><span class='line'>  <span class="o">-</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">2.3</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">4.5</span>
</span><span class='line'>  <span class="o">-</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">2.3</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">4.5</span>
</span><span class='line'><span class="p">{</span><span class="s">&quot;six&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;456&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;two&quot;</span><span class="p">:</span> <span class="s">&quot;4&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">:</span> <span class="s">&quot;8.800000000000001&quot;</span><span class="p">,</span> <span class="s">&quot;four&quot;</span><span class="p">:</span> <span class="s">&quot;false&quot;</span><span class="p">},</span> <span class="s">&quot;123&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;three&quot;</span><span class="p">:</span> <span class="s">&quot;6.6&quot;</span><span class="p">,</span> <span class="s">&quot;four&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="s">&quot;two&quot;</span><span class="p">:</span> <span class="s">&quot;3&quot;</span><span class="p">}},</span> <span class="s">&quot;seven&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s">&quot;two&quot;</span><span class="p">:</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">:</span> <span class="s">&quot;1.1&quot;</span><span class="p">,</span> <span class="s">&quot;four&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s">&quot;two&quot;</span><span class="p">:</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;three&quot;</span><span class="p">:</span> <span class="s">&quot;2.2&quot;</span><span class="p">,</span> <span class="s">&quot;four&quot;</span><span class="p">:</span> <span class="s">&quot;true&quot;</span><span class="p">}],</span> <span class="s">&quot;eight&quot;</span><span class="p">:</span> <span class="s">&quot;eight&quot;</span><span class="p">,</span> <span class="s">&quot;nine&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="s">&quot;2.3&quot;</span><span class="p">,</span> <span class="s">&quot;4.5&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s">&quot;2.3&quot;</span><span class="p">,</span> <span class="s">&quot;4.5&quot;</span><span class="p">]]}</span>
</span><span class='line'><span class="o">==============</span>
</span><span class='line'><span class="n">eight</span><span class="p">:</span> <span class="n">nine</span>
</span><span class='line'><span class="n">six</span><span class="p">:</span>
</span><span class='line'>  <span class="mi">234</span><span class="p">:</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">5.5</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">4</span>
</span><span class='line'>  <span class="mi">345</span><span class="p">:</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">6</span>
</span><span class='line'>    <span class="n">three</span><span class="p">:</span> <span class="mf">7.7</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">false</span>
</span><span class='line'><span class="n">seven</span><span class="p">:</span>
</span><span class='line'>  <span class="o">-</span> <span class="n">three</span><span class="p">:</span> <span class="mf">9.9</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">8</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'>  <span class="o">-</span> <span class="n">three</span><span class="p">:</span> <span class="mf">3.3</span>
</span><span class='line'>    <span class="n">two</span><span class="p">:</span> <span class="mi">2</span>
</span><span class='line'>    <span class="n">four</span><span class="p">:</span> <span class="n">true</span>
</span><span class='line'><span class="n">nine</span><span class="p">:</span>
</span><span class='line'>  <span class="o">-</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">3.4</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">5.6</span>
</span><span class='line'>  <span class="o">-</span>
</span><span class='line'>    <span class="o">-</span> <span class="mf">7.8</span>
</span><span class='line'>    <span class="o">-</span> <span class="mi">9</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below is a full copy of the above code that you can compile and run:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="c1">// yaml.cpp</span>
</span><span class='line'><span class="c1">// Copyright (C) 2015 Joe Ruether jrruethe@gmail.com</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// This program is free software: you can redistribute it and/or modify</span>
</span><span class='line'><span class="c1">// it under the terms of the GNU General Public License as published by</span>
</span><span class='line'><span class="c1">// the Free Software Foundation, either version 3 of the License, or</span>
</span><span class='line'><span class="c1">// (at your option) any later version.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// This program is distributed in the hope that it will be useful,</span>
</span><span class='line'><span class="c1">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span class='line'><span class="c1">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
</span><span class='line'><span class="c1">// GNU General Public License for more details.</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// You should have received a copy of the GNU General Public License</span>
</span><span class='line'><span class="c1">// along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/foreach.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/adapted.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/at_c.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/at.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/for_each.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/size.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/value_at.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/include/zip.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/mpl.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/sequence.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/fusion/support.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/mpl/eval_if.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/mpl/identity.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/mpl/next_prior.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/mpl/range_c.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/type_traits.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/typeof/typeof.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/units/detail/utility.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;boost/utility/enable_if.hpp&gt;</span>
</span><span class='line'><span class="cp">#include &lt;yaml-cpp/yaml.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">yaml</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">namespace</span> <span class="n">detail</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">sequence</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Point to the first element</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">begin</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Point to the element after the last element in the sequence</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">end</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Point to the first element</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">first</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Point to the second element (for pairs)</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">int_</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">second</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Point to the last element in the sequence</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">prior</span><span class="o">&lt;</span><span class="n">end</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">last</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Number of elements in the sequence</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">size</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">range_c</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">size</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span>
</span><span class='line'>               <span class="k">typename</span> <span class="n">N</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">element_at</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Type of the element at this index</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">value_at</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Previous element</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">prior</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">previous</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Next element</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">mpl</span><span class="o">::</span><span class="n">next</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">next</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Member name of the element at this index</span>
</span><span class='line'>         <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>           <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">extension</span><span class="o">::</span><span class="n">struct_member_name</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">N</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;::</span><span class="n">call</span><span class="p">();</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Type name of the element at this index</span>
</span><span class='line'>         <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>           <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="n">type</span><span class="p">).</span><span class="n">name</span><span class="p">());</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Access the element</span>
</span><span class='line'>         <span class="k">static</span> <span class="kr">inline</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at</span><span class="o">&lt;</span><span class="n">S</span> <span class="k">const</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">get</span><span class="p">(</span><span class="n">S</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>           <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">type</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Return the string name of the type</span>
</span><span class='line'>         <span class="k">static</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">boost</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">demangle</span><span class="p">(</span><span class="k">typeid</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">name</span><span class="p">());</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">inserter</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">T</span> <span class="n">Type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="n">inserter</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">subroot</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>            <span class="n">mSubroot</span><span class="p">(</span><span class="n">subroot</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Zip</span><span class="o">&gt;</span>
</span><span class='line'>         <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Zip</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">zip</span><span class="p">)</span> <span class="k">const</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_const</span><span class="o">&lt;</span>
</span><span class='line'>                       <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_reference</span><span class="o">&lt;</span>
</span><span class='line'>                          <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="n">Zip</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                       <span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                    <span class="o">&gt;::</span><span class="n">type</span> <span class="n">Index</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Get the field name as a string using reflection</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">field_name</span> <span class="o">=</span> <span class="n">element_at</span><span class="o">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Index</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Get the field type</span>
</span><span class='line'>            <span class="k">typedef</span> <span class="n">BOOST_TYPEOF</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">))</span> <span class="n">FieldType</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Alias the member</span>
</span><span class='line'>            <span class="n">FieldType</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">member</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Store this field in the yaml node</span>
</span><span class='line'>            <span class="n">mSubroot</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">protected</span><span class="o">:</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">mSubroot</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="k">struct</span> <span class="n">extractor</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="n">T</span> <span class="n">Type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="n">extractor</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">subroot</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>            <span class="n">mSubroot</span><span class="p">(</span><span class="n">subroot</span><span class="p">),</span>
</span><span class='line'>            <span class="n">mItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Zip</span><span class="o">&gt;</span>
</span><span class='line'>         <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">Zip</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">zip</span><span class="p">)</span> <span class="k">const</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">typedef</span> <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_const</span><span class="o">&lt;</span>
</span><span class='line'>                       <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">remove_reference</span><span class="o">&lt;</span>
</span><span class='line'>                          <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">result_of</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="n">Zip</span><span class="p">,</span> <span class="mi">0</span><span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                       <span class="o">&gt;::</span><span class="n">type</span>
</span><span class='line'>                    <span class="o">&gt;::</span><span class="n">type</span> <span class="n">Index</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Get the field name as a string using reflection</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">field_name</span> <span class="o">=</span> <span class="n">element_at</span><span class="o">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Index</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Get the field native type</span>
</span><span class='line'>            <span class="k">typedef</span> <span class="n">BOOST_TYPEOF</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">))</span> <span class="n">FieldType</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Alias the member</span>
</span><span class='line'>            <span class="c1">// We need to const cast this because &quot;boost::fusion::for_each&quot;</span>
</span><span class='line'>            <span class="c1">// requires that zip be const, however we want to modify it.</span>
</span><span class='line'>            <span class="n">FieldType</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">const_member</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">at_c</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">zip</span><span class="p">);</span>
</span><span class='line'>            <span class="n">FieldType</span><span class="o">&amp;</span> <span class="n">member</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">const_member</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// We need to const cast this because &quot;boost::fusion::for_each&quot;</span>
</span><span class='line'>            <span class="c1">// requires that operator() be const, however we want to modify</span>
</span><span class='line'>            <span class="c1">// the object. This item number is used for error reporting.</span>
</span><span class='line'>            <span class="kt">int</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">const_item</span> <span class="o">=</span> <span class="n">mItem</span><span class="p">;</span>
</span><span class='line'>            <span class="kt">int</span><span class="o">&amp;</span> <span class="n">item</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">const_item</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Try to load the value from the file</span>
</span><span class='line'>            <span class="k">try</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>               <span class="c1">// Extract this field from the yaml node</span>
</span><span class='line'>               <span class="n">member</span> <span class="o">=</span> <span class="n">mSubroot</span><span class="p">[</span><span class="n">field_name</span><span class="p">].</span><span class="n">as</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&gt;</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>               <span class="c1">// This item number helps us find issues when loading incomplete yaml files</span>
</span><span class='line'>               <span class="o">++</span><span class="n">item</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// Catch any exceptions</span>
</span><span class='line'>            <span class="k">catch</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Exception</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>               <span class="c1">// Print out some helpful information to find the error in the yaml file</span>
</span><span class='line'>               <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">type_name</span> <span class="o">=</span> <span class="n">type</span><span class="o">&lt;</span><span class="n">FieldType</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">();</span>
</span><span class='line'>               <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Error loading item &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span>  <span class="o">&lt;&lt;</span> <span class="s">&quot; : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">type_name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">field_name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>               <span class="c1">// &quot;boost::fusion::for_each&quot; requires operator() to return void,</span>
</span><span class='line'>               <span class="c1">// so the only way to signal that an error occurred is to throw</span>
</span><span class='line'>               <span class="c1">// an exception.</span>
</span><span class='line'>               <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">protected</span><span class="o">:</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span><span class="o">&amp;</span> <span class="n">mSubroot</span><span class="p">;</span>
</span><span class='line'>         <span class="kt">int</span> <span class="n">mItem</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// We are going to inject some stuff into the 3rd party Yaml-cpp namespace</span>
</span><span class='line'><span class="k">namespace</span> <span class="n">YAML</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="c1">// Normally, a second template parameter would be used as an enabler and default to void.</span>
</span><span class='line'>   <span class="c1">// Then we could use boost::enable_if to enable specific specializations.</span>
</span><span class='line'>   <span class="c1">// Unfortunately, we are specializing an already-declared structure in a 3rd party namespace.</span>
</span><span class='line'>   <span class="c1">// On the plus side, the struct was only forward declared; it hasn&#39;t been defined.</span>
</span><span class='line'>   <span class="c1">// Therefore, we have the freedom to define it!</span>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="k">struct</span> <span class="n">convert</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'>      <span class="k">static</span> <span class="n">Node</span> <span class="n">encode</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                         <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// For each item in T</span>
</span><span class='line'>         <span class="c1">// Call inserter recursively</span>
</span><span class='line'>         <span class="c1">// Every sequence is made up of primitives at some level</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Make a root node to insert into</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an inserter for the root node</span>
</span><span class='line'>         <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">inserter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">inserter</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Insert each member of the structure</span>
</span><span class='line'>         <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">),</span> <span class="n">inserter</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">return</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// This function will only be available if the template parameter is a boost fusion sequence</span>
</span><span class='line'>      <span class="k">static</span> <span class="kt">bool</span> <span class="n">decode</span><span class="p">(</span><span class="n">Node</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">node</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">rhs</span><span class="p">,</span>
</span><span class='line'>                         <span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">is_sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">*</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// For each item in T</span>
</span><span class='line'>         <span class="c1">// Call extractor recursively</span>
</span><span class='line'>         <span class="c1">// Every sequence is made up of primitives at some level</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an extractor for the root node</span>
</span><span class='line'>         <span class="c1">// Yaml-cpp requires node to be const&amp;, but the extractor makes</span>
</span><span class='line'>         <span class="c1">// non-const calls to it.</span>
</span><span class='line'>         <span class="n">Node</span><span class="o">&amp;</span> <span class="n">writable_node</span> <span class="o">=</span> <span class="k">const_cast</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</span><span class='line'>         <span class="n">yaml</span><span class="o">::</span><span class="n">detail</span><span class="o">::</span><span class="n">extractor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">extractor</span><span class="p">(</span><span class="n">writable_node</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Extract each member of the structure</span>
</span><span class='line'>         <span class="k">try</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// An exception is thrown if any item in the loop cannot be read</span>
</span><span class='line'>            <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">),</span> <span class="n">extractor</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="c1">// Catch all exceptions and prevent them from propagating</span>
</span><span class='line'>         <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// If we made it here, all fields were read correctly</span>
</span><span class='line'>         <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">yaml</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="k">class</span> <span class="nc">Yaml</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>   <span class="k">public</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">T</span> <span class="n">Base</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Convert this object to yaml</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_yaml</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create an emitter</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span> <span class="n">emitter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit yaml</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emit</span><span class="p">(</span><span class="n">emitter</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Convert this object to json</span>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">to_json</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create an emitter</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span> <span class="n">emitter</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Set the emitter manipulators for json</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Flow</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">DoubleQuoted</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">TrueFalseBool</span><span class="p">;</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">YAML</span><span class="o">::</span><span class="n">EscapeNonAscii</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit json</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emit</span><span class="p">(</span><span class="n">emitter</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Load yaml into this object</span>
</span><span class='line'>      <span class="kt">bool</span> <span class="n">from_yaml</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">yaml_string</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Create a root node to load into</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="k">try</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Try loading the root node</span>
</span><span class='line'>            <span class="n">root</span> <span class="o">=</span> <span class="n">YAML</span><span class="o">::</span><span class="n">Load</span><span class="p">(</span><span class="n">yaml_string</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// The yaml couldn&#39;t be parsed</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Invalid yaml&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an extractor for the root node</span>
</span><span class='line'>         <span class="n">detail</span><span class="o">::</span><span class="n">extractor</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">extractor</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Extract each member of the structure</span>
</span><span class='line'>         <span class="k">try</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// An exception is thrown if any item in the loop cannot be read</span>
</span><span class='line'>            <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">self</span><span class="p">()),</span> <span class="n">extractor</span><span class="p">);</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>         <span class="c1">// Catch all exceptions and prevent them from propagating</span>
</span><span class='line'>         <span class="k">catch</span><span class="p">(...)</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// If we made it here, all fields were read correctly</span>
</span><span class='line'>         <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// The yaml parser can also parse json</span>
</span><span class='line'>      <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">from_json</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">json_string</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">from_yaml</span><span class="p">(</span><span class="n">json_string</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">protected</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">emit</span><span class="p">(</span><span class="n">YAML</span><span class="o">::</span><span class="n">Emitter</span><span class="o">&amp;</span> <span class="n">emitter</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="c1">// Get a range representing the size of the structure</span>
</span><span class='line'>         <span class="k">typedef</span> <span class="k">typename</span> <span class="n">detail</span><span class="o">::</span><span class="n">sequence</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;::</span><span class="n">indices</span> <span class="n">indices</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Make a root node to insert into</span>
</span><span class='line'>         <span class="n">YAML</span><span class="o">::</span><span class="n">Node</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Create an inserter for the root node</span>
</span><span class='line'>         <span class="n">detail</span><span class="o">::</span><span class="n">inserter</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span> <span class="n">inserter</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Insert each member of the structure</span>
</span><span class='line'>         <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">zip</span><span class="p">(</span><span class="n">indices</span><span class="p">(),</span> <span class="n">self</span><span class="p">()),</span> <span class="n">inserter</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Emit yaml</span>
</span><span class='line'>         <span class="n">emitter</span> <span class="o">&lt;&lt;</span> <span class="n">root</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>         <span class="c1">// Return string representation</span>
</span><span class='line'>         <span class="k">return</span> <span class="n">emitter</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">private</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Cast ourselves to our CRTP base</span>
</span><span class='line'>      <span class="n">Base</span><span class="o">&amp;</span> <span class="n">self</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;string&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sstream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;map&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">yaml</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="n">test</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">struct</span> <span class="n">One</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">friend</span> <span class="n">boost</span><span class="o">::</span><span class="n">fusion</span><span class="o">::</span><span class="n">extension</span><span class="o">::</span><span class="n">access</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">One</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>         <span class="n">two</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
</span><span class='line'>         <span class="n">three</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
</span><span class='line'>         <span class="n">four</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">One</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">c</span><span class="p">)</span> <span class="o">:</span>
</span><span class='line'>         <span class="n">two</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
</span><span class='line'>         <span class="n">three</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
</span><span class='line'>         <span class="n">four</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">int</span> <span class="n">two</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">double</span> <span class="n">three</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">private</span><span class="o">:</span>
</span><span class='line'>      <span class="kt">bool</span> <span class="n">four</span><span class="p">;</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">struct</span> <span class="n">Five</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Yaml</span><span class="o">&lt;</span><span class="n">Five</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">One</span><span class="o">&gt;</span> <span class="n">Map_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Map_t</span> <span class="n">six</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">One</span><span class="o">&gt;</span> <span class="n">Vector_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Vector_t</span> <span class="n">seven</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">eight</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">Matrix_t</span><span class="p">;</span>
</span><span class='line'>      <span class="n">Matrix_t</span> <span class="n">nine</span><span class="p">;</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">BOOST_FUSION_ADAPT_STRUCT</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>   <span class="n">test</span><span class="o">::</span><span class="n">One</span><span class="p">,</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">two</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">four</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">BOOST_FUSION_ADAPT_STRUCT</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>   <span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="p">,</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Map_t</span><span class="p">,</span> <span class="n">six</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Vector_t</span><span class="p">,</span> <span class="n">seven</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">eight</span><span class="p">)</span>
</span><span class='line'>   <span class="p">(</span><span class="n">test</span><span class="o">::</span><span class="n">Five</span><span class="o">::</span><span class="n">Matrix_t</span><span class="p">,</span> <span class="n">nine</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">test</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="n">Five</span> <span class="n">v</span><span class="p">;</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">six</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="n">One</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="kc">true</span><span class="p">)));</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">six</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">456</span><span class="p">,</span> <span class="n">One</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">8.8</span><span class="p">,</span> <span class="kc">false</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">seven</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">One</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">seven</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">One</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">eight</span> <span class="o">=</span> <span class="s">&quot;eight&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">temp</span><span class="p">;</span>
</span><span class='line'>   <span class="n">temp</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mf">2.3</span><span class="p">);</span>
</span><span class='line'>   <span class="n">temp</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mf">4.5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">nine</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">nine</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_json</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">///////////////////////////////////////////</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;==============&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;six:            </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  234:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    two: 4      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 5.5  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  345:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    two: 6      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 7.7  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: false </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;seven:          </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  - two: 8      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 9.9  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  - two: 2      </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    three: 3.3  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    four: true  </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;eight: nine     </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;nine:           </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  -             </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 3.4       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 5.6       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;  -             </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 7.8       </span><span class="se">\n</span><span class="s">&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="s">&quot;    - 9.0       </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">v</span><span class="p">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
</span><span class='line'>   <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">to_yaml</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p><a href="https://github.com/jbeder/yaml-cpp">Yaml-cpp</a> &ndash; Jesse Beder<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joe Ruether</span></span>

      








  


<time datetime="2015-08-17T20:17:35-04:00" pubdate data-updated="true">Aug 17<span>th</span>, 2015</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/" data-via="jrruethe" data-counturl="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/" >Tweet</a>
  
  
  
</div>

    
    
<div class="changetip_tipme_button" data-bid="4w8JumCxV7mYAPA8ahW73N" data-uid="ua8VCts3futd94QTwFQHoa"></div><script>(function(document,script,id){var js,r=document.getElementsByTagName(script)[0],protocol=/^http:/.test(document.location)?'http':'https';if(!document.getElementById(id)){js=document.createElement(script);js.id=id;js.src=protocol+'://widgets.changetip.com/public/js/widgets.js';r.parentNode.insertBefore(js,r)}}(document,'script','changetip_w_0'));</script>

    <br>

    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/08/02/singletons/" title="Previous Post: Singletons">&laquo; Singletons</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/08/23/placement-new/" title="Next Post: Placement New, Memory Dumps, and Alignment">Placement New, Memory Dumps, and Alignment &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <img class="center borderless" src="/blog/contact/avatar.png" width="128" height="128">
  <h1>Contact</h1>
  <p>
  <a href="mailto:jrruethe@gmail.com">jrruethe@gmail.com</a><br>
  <a href="https://keybase.io/jrruethe">keybase.io/jrruethe</a><br>
  <a href="https://onename.io/jrruethe">onename.io/jrruethe</a><br>
  <br>Public Key:<br>
  <a href="http://jrruethe.github.io/downloads/code/jrruethe-public.asc">4F40 99F8 276B DBA5 475A<br>8446 4630 BEDC 40B9 35FE</a>
  </p>
</section>
<section>
<a href="https://twitter.com/jrruethe" class="twitter-follow-button" data-show-count="true">Follow @jrruethe</a><br>
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/" data-via="jrruethe" data-counturl="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/" >Tweet</a>
</section>
<section>
<h1>Link to this page</h1>
<br>
<center>
<a href="http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=000000&chl=http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/" alt="post-qrcode"></a>
</center>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/04/bitcoin-donations/">Bitcoin Donations</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/26/object-pool/">Object Pool</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/25/memory-blocks/">Memory Blocks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/24/google-test/">Google Test</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/23/aligned-heap/">Aligned Heap</a>
      </li>
    
  </ul>
</section>
<section>
   <h1>Related Posts</h1>
   <ul class="posts">
   
      <li class="related">
      <a href="/blog/2015/05/21/boost-fusion-json-serializer/">Boost Fusion Json Serializer</a>
      </li>
   
      <li class="related">
      <a href="/blog/2015/08/02/singletons/">Singletons</a>
      </li>
   
      <li class="related">
      <a href="/blog/2015/08/23/placement-new/">Placement New, Memory Dumps, and Alignment</a>
      </li>
   
      <li class="related">
      <a href="/blog/2015/06/30/parameter-forwarding/">Parameter Forwarding</a>
      </li>
   
      <li class="related">
      <a href="/blog/2015/11/22/allocators/">C++ Allocators</a>
      </li>
   
   </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jrruethe">@jrruethe</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jrruethe',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
	<h1>Bitcoin Donations</h1>
	<br>
	<center>
	<a href="bitcoin:187gRAhdyD2KaAhMND92RQMqQQMQtW678m"><img src="http://blockchain.info/qr?data=187gRAhdyD2KaAhMND92RQMqQQMQtW678m&size=150" alt="Bitcoin"></a><br>
	<a class="small, monospace" href="bitcoin:187gRAhdyD2KaAhMND92RQMqQQMQtW678m">187gRAhdyD2KaAhMN</a><br>
	<a class="small, monospace" href="bitcoin:187gRAhdyD2KaAhMND92RQMqQQMQtW678m">D92RQMqQQMQtW678m</a>
	<br>
	<a href="/downloads/code/bitcoin.txt.asc">Proof</a>
	<br><br>
   <div id="coindesk-widget" data-align="center"></div>
   <script type="text/javascript" src="//widget.coindesk.com/bpiticker/coindesk-widget.min.js?aa4aca"></script>
	</center>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  <span class="license">
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
   - Copyright &copy; 2016 - Joe Ruether - All rights reserved with the following exceptions:
  <br>
   - All embedded code on this page licensed under
    <a href="/blog/downloads/code/gpl-3.0.txt">GPLv3</a>
    or a later version unless otherwise noted
  <br>
   - All non-code text/image content on this page licensed under
    <a href="/blog/downloads/code/cc-by-nc-sa-4.0.txt">CC BY-NC-SA 4.0</a>
    or a later version unless otherwise noted
  </span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jrruethe';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/';
        var disqus_url = 'http://jrruethe.github.io/blog/2015/08/17/yaml-de-slash-serialization-with-boost-fusion/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
